---
layout: post
title: macOS Big Sur (Apple Silicon) におけるUTMのVM上で OS X Mavericks (Intel) を動かすお話
categories: 雑記 開発環境
---

こうしてタイトルを書くと同じ系列のOSにはちょっと見えにくいですね。  
……というワケで今回はこんなことをやっていた記録を、他に誰が役立てられるのか定かでない話ながら纏めておくことに。

## そもそもの動機

カッコイイんですよね、OS X Mavericks。それだけと言えばそれだけ。  
だけかもしれないんですが、個人的に初めて触ったMac系OSでして、思い入れもかなり強かったりします。  
その思い入れを更に強めているのが、現時点で非フラットデザインな最後のMac系OSであること。あまり深く考えないままOSをアップグレードしたらデザインがガラリと変わっていた時の衝撃たるや。  
(少し脱線しますが、ブラウザに関しても個人的に以前使っていたChromium派生ブラウザがデザイン刷新の煽りでフラットデザインになった際は、年単位でその先のアプデを断固拒否していたほど)(皆さんはちゃんとアプデしましょうね)  
そのため、どこかのタイミングで仮想環境にでもMavericksを再び入れてみようと機を窺っていました。

## じゃあ結局どうやるの？

### ・インストールISO作成編

現在、Mavericksをインストールしたいと思っても誰もがそう簡単にできるワケではありません。  
一番の理由はMavericks以前のOS X インストーラが既に公式で提供されていない点。  
ボク自身が所持しているMacはプリインストールされたOSがMavericksだったので、16GBのUSBにインストーラをダウンロードできました。この条件に合致する端末を持っていない場合、まずはそれを入手しなければなりません。  
所持しているなら、まずリカバリモードに入ってUSBにインストーラを落とします。([参考記事1][Ref1])  
(このリカバリモードはCmd + Shift + Option + rで入るモードですのでお間違えなきよう)

尚、参考記事1で行う過程は「USBを引っこ抜く」ところまで。  
USBにインストーラを作成したい場合は先の記事を最後までご覧ください。(ボク自身はUSBからMavericksを直接インストールする方法を試していないのでご了承いただけると……)

USBの準備が出来たら次はhdiutilを用いてインストールISOの本格的な作成に入ります。([参考記事2][Ref2])  
ここで出てくる “InstallESD.dmg” は先に準備したUSBを開くと、”OS X Install Data” ディレクトリ内にあります。
(ちなみに参考記事2でやっていることは参考記事1とも共通する箇所があります。ただ一度USBインストーラからそのままディスクユーティリティで作成したISOは削除してしまっていたので、コマンドラインから作業したほうがやりやすいのもありこちらの手法を取りました)

### ・VMへのインストール編

ここから先は、UTM上のVMへMojaveをインストールした例に倣ってやっていきます。([参考記事3][Ref3])  
というかありがたいことに、この参考記事3ではMojave以外のインストールにも触れられていました。  
先の記事内には “BaseSystem.dmg” を使うと書いてある箇所がありますが、ここを先程作っていたISOに置き換えてVMの起動を試みます。  
アーキテクチャの異なるエミュレートであるせいもあってか相応の時間はかかるものの、インストーラは普通に起動し上手くMavericksのインストールができます。
インストールが終わったら仮想USBポートからISOを取り外せばOK。

Mavericksがボクの手元にまた戻ってきました。

## 改善したいポイント

今回Mavericksをインストールするケースにおいて、現状ネットワークの設定は参考記事3の通りに行ってもインターネットへの接続が確保できませんでした。  
ここの問題が解決していたとしたら ”InstallESD.dmg” をマウントした中に存在するオンラインインストーラ “BaseSystem.dmg” (参考記事3で使われているインストーラ) でもMavericksを導入可能かもしれません。  
先の手順でISOを作っていれば、それはオフライン対応のインストーラになります。もし同じ作業を行ってインターネット接続ができなかった場合はぜひこちらを利用してみてください。

あとはちょっとした理由でUTMを使わず少し違ったやり方でこの仮想環境を立ち上げてみたい、という願望も少しだけあり……  
それもいずれやってみたいところ。

[Ref1]: https://soundability.tokyo/pc/20014/
[Ref2]: https://yama-mac.com/diskutility_create_macos_install_iso/
[Ref3]: https://khronokernel.github.io/apple/silicon/2021/01/17/QEMU-AS.html
